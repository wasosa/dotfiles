#!/bin/bash

set -o errexit
set -o pipefail

lhs=
rhs=
quiet=false
diff=true
common=false

usage()
{
  echo
  echo "USAGE: $0 <lhs> <rhs> [flags]"
  echo
  echo "FLAGS: --[no-]common|--[no-]diff|--help|--quiet|--verbose"
  echo
}

check_file()
{
  if test -z "$1"
  then
    usage
    exit 1
  fi
  if ! test -f "$1"
  then
    echo ERROR: unable to find: $1
    exit 1
  fi
}

for arg in $@
do
  case $arg in
    --help|-h) usage ; exit 0;;
    --quiet|-q) quiet=true ;;
    --diff) diff=true ;;
    --no-diff) diff=false ;;
    --common) common=true ;;
    --no-common) common=false ;;
    *) if test -z "$lhs" ; then lhs=$arg ; elif test -z "$rhs" ; then rhs=$arg ; fi ;;
  esac
done

check_file $lhs
check_file $rhs

if $quiet
then
  echo
  /usr/bin/printf "%4d LINES IN BOTH\n" $(grep -Fx $lhs -f $rhs -c)
  /usr/bin/printf "%4d LINES ONLY IN $lhs\n" $(grep -Fxv $lhs -f $rhs -c)
  /usr/bin/printf "%4d LINES ONLY IN $rhs\n" $(grep -Fxv $rhs -f $lhs -c)
  echo
else
  if $common
  then
    echo
    /usr/bin/printf "==== %4d LINES IN BOTH: ====\n" $(grep -Fx $lhs -f $rhs -c)
    echo
    grep -Fx $lhs -f $rhs
  fi
  if $diff
  then
    echo
    /usr/bin/printf "==== %4d LINES ONLY IN $lhs: ====\n" $(grep -Fxv $lhs -f $rhs -c)
    echo
    grep -Fxv $lhs -f $rhs
    echo
    /usr/bin/printf "==== %4d LINES ONLY IN $rhs: ====\n" $(grep -Fxv $rhs -f $lhs -c)
    echo
    grep -Fxv $rhs -f $lhs
    echo
  fi
fi

# end of file
